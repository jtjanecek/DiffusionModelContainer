Bootstrap: library
From: ubuntu:20.04
Stage: build

%environment
    export LISTEN_PORT=12345
    export LC_ALL=C

%post
	NOW=`date`
	echo "export NOW=\"${NOW}\"" >> $SINGULARITY_ENVIRONMENT

	apt-get install software-properties-common -y
	apt-get update
	add-apt-repository universe
	add-apt-repository ppa:deadsnakes/ppa

   	echo "deb http://ppa.launchpad.net/cidlab/jwm/ubuntu yakkety main" >> /etc/apt/sources.list 
	echo "deb-src http://ppa.launchpad.net/cidlab/jwm/ubuntu yakkety main" >> /etc/apt/sources.list 
	apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 8982B0C0FB2FA51DCAEBF21479D1BE170F2A3BF9

	apt-get update

	apt-get install -y git jags jags-wiener-module python3.9 -y

	git clone https://github.com/jtjanecek/py2jags

%runscript
    echo "Container was created $NOW"
	echo $LISTEN_PORT
    echo "Arguments received: $*"
    exec echo "$@"

%test
	grep -q NAME=\"Ubuntu\" /etc/os-release
	if [ $? -eq 0 ]; then
		echo "Container base is Ubuntu as expected."
	else
		echo "Container base is not Ubuntu."
		exit 1
	fi

%labels
	Author John Janecek
	Version v0.0.1

%help
	This container is to run JAGS with the Python helper wrapper
